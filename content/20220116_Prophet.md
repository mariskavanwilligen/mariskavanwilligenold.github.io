Title: Prophet and Neural Prophet
Date: 2022-01-16 15:20
Modified: 2022-01-16 15:20
Tags: Timeseries, Intro, Trend, Noise, Seasonality
Slug: prophet
Authors: Mariska van Willigen
Summary: Prophet & Neural Prophet

Prophet is a procedure released by Facebook for forecasting time series data based on an additive model where non-linear trends are fit with yearly, weekly, and daily seasonality, plus holiday effects. Prophet (2017) is the predecessor to NeuralProphet (2020) — the latter combines the Prophet model with deep learning.

# Prophet
According to Facebook, Prophet offers a straightforward way to create a ‘reasonable and accurate forecast’
The Prophet procedure is an additive regression model with four main components:
— a piecewise linear logistic growth curve trend
- a yearly seasonal component modelled using Fourier series
- a weekly seasonal component created using dummy variables
- a user-provided list of important holidays.

<!-- # Trend

# Seasonality -->

# Trend Changepoints
Changepoints are the points in time where the rate is changed. This can be due to a different marketing strategy or opening a new distribution centre for example. By default, Prophet specifies 25 potential changepoints which are uniformly placed in the first 80% of the time series.
The vertical lines are where the changepoints are defined:

![](/images/prophet/changepoints.png)


Within that 80% 12 changepoints are uniformily selected:
![](images/prophet/changepoints_select.png)



- `n_changepoints` : You can specify how many changepoints you want to be selected, however you can better tune this with adding regularization.
- `changepoint_range`: This is to specify how big the range should be of with Prophet will place the n changepoints. Default is set to 0.80. Which means that the n changepoint will be placed in the first 80% of the time series. This 80% is chosen to avoid overfitting.
- `changepoint.prior.scale`: If the trend changes are being overfit (too much flexibility) or underfit (not enough flexibility), you can adjust the strength of the sparse prior. Default is set to 0.05, increasing will lead to more flexibility.


You are also able to specify changepoints yourself, for example if you know specific timestamps on which you expect a rate change or if Prophet missed a changepoint or overfits on the data. You can do this by giving Prophet a list of changepoint to the model:
```js
m = Prophet(changepoints=['2019-01-01', '2020-01-01', '2021-01-01'])
forecast = m.fit(df).predict(future)
fig = m.plot(forecast)
```

# Holidays
Below you can find an example to specify your holidays. Lower window ad upper window defines how much effect of this holiday you expect to last before and after the date of ds. 
```js
holidays = []
kerst = pd.DataFrame({
  'holiday': 'kerst',
  'ds': pd.to_datetime(['2017-12-25', '2018-12-25', '2019-12-25', 
                        '2020-12-25', '2021-12-25', '2022-12-25', 
                        '2023-12-25', '2024-12-25', '2025-12-25',
                       '2026-12-25', '2027-12-25', '2028-12-25']),
  'lower_window': -3,
  'upper_window': 1,
})
nye = pd.DataFrame({
  'holiday': 'nye',
  'ds': pd.to_datetime(['2017-12-31', '2018-12-31', '2019-12-31', 
                        '2020-12-31', '2021-12-31', '2022-12-31', 
                        '2023-12-31', '2024-12-31', '2025-12-31',
                       '2026-12-31', '2027-12-31', '2028-12-31']),
  'lower_window': -1,
  'upper_window': 1,
})
holidays = pd.concat((kerst, nye))
```

![](/images/prophet/holidays.png)


After the holidays are specified, you can give the holidays to your Prophet model as follows:
```js
m = Prophet(holidays=holidays)
forecast = m.fit(df).predict(future)
```

# Disadvantage
The challenge with Facebook Prophet is that it does not look for casual relationships between the past and the future. It simply finds the best curve to fit the data using a linear logistic curve component for the external regressor. Another major criticism against Prophet is that its underlying assumptions are simplistic and weak. F


# Disadvantage Neural Prophet
It is not possible to add regressores for which we don't have future values